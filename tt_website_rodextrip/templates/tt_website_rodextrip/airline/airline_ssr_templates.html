{% extends 'tt_website_rodextrip/template_website_booking.html' %}
{% load i18n %}
{% load static from staticfiles %}
{% block content %}
<!--<script src="{{ static_path }}js/webservice_token.js"></script>-->
<!--<script src="{{ static_path }}vendor/jquery/jquery-3.2.1.min.js?version={{javascript_version}}"></script>-->
<script src="{{ static_path }}js/webservice_token.js?version={{javascript_version}}"></script>
<script src="{{ static_path }}js/webservice_agent.js?version={{javascript_version}}"></script>
<script src="{{ static_path }}js/webservice_airline.js?version={{javascript_version}}"></script>
<script src="{{ static_path }}js/airline_javascript.js?version={{javascript_version}}"></script>
<script src="{{ static_path }}js/agent_javascript.js?version={{javascript_version}}"></script>
<script src="{{ static_path }}js/moment.js?version={{javascript_version}}"></script>

<script>
    static_path_url_server = '{{static_path_url_server}}'
    airline_carriers = `{{airline_carriers}}`;
    after_sales = {{after_sales}};

    len_passenger = {{passengers|length}};
    upsell_price = {{upsell}};
    ssr_keys = [];
    {% for ssr_availability_provider in airline_ssrs.ssr_availability_provider %}
        {% with forloop.counter as counter_provider%}
        {% for key, value in ssr_availability_provider.ssr_availability.items %}
            ssr_keys.push({
                'key': '{{key}}',
                'len': {{value|length}},
                'provider': {{counter_provider}}
            });
        {% endfor %}
        {% endwith %}
    {% endfor %}
    signature = `{{signature}}`;
    if({{after_sales}} == 0){
        time_limit = '{{time_limit}}';
        if(time_limit != ''){
            time_limit = parseInt(time_limit);
            session_time_limit();
        }

        breadcrumb = 1;
        additional_price = `{{additional_price}}`;
        if(additional_price != ''){
            additional_price_fix = parseInt(additional_price);
        }else{
            additional_price_fix = 0;
        }
    }else if({{after_sales}} == 1){
        //request new
        time_limit = '{{time_limit}}';
        breadcrumb = 2;
    }

    function print_nominal_ssr(id_var, ssr_price){
        var nominal_ssr = getrupiah(ssr_price);
        document.getElementById("ssr_option_"+id_var).innerHTML += nominal_ssr;
    }
</script>
{% include 'tt_website_rodextrip/check_connection.html' %}
{% include 'tt_website_rodextrip/modal_balance_vendor.html' %}
<title>{{name}} {% trans 'Airline' %} - SSR</title>
{% include 'tt_website_rodextrip/logout.html' %}
    {%if template == 1%}
    <header id="header" class="header_breadcrumb">
    {% if 'co_customer_parent_type_name' in username and 'corp_limitation' not in username.co_agent_frontend_security %}
    {% include 'tt_website_rodextrip/header_corporate.html' %}
    {% endif %}
    <div class="main-menu">
    {%elif template == 2%}
    <header style="z-index:100;background:white;">
    {% if 'co_customer_parent_type_name' in username and 'corp_limitation' not in username.co_agent_frontend_security %}
    {% include 'tt_website_rodextrip/header_corporate.html' %}
    {% endif %}
    <div class="main-menu" style="border-bottom:1px solid #cdcdcd; padding:15px 0px 15px 0px;">
    {%elif template == 3%}
    <header style="z-index:100;background:white;">
    {% if 'co_customer_parent_type_name' in username and 'corp_limitation' not in username.co_agent_frontend_security %}
    {% include 'tt_website_rodextrip/header_corporate.html' %}
    {% endif %}
    <div class="main-menu" style="border-bottom:1px solid #cdcdcd; padding:15px 0px 15px 0px;">
    {%elif template == 4%}
    <header style="z-index:100;background:white;">
    {% if 'co_customer_parent_type_name' in username and 'corp_limitation' not in username.co_agent_frontend_security %}
    {% include 'tt_website_rodextrip/header_corporate.html' %}
    {% endif %}
    <div class="main-menu" style="border-bottom:1px solid #cdcdcd; padding:15px 0px 15px 0px;">
    {%elif template == 5%}
    <header>
    {% if 'co_customer_parent_type_name' in username and 'corp_limitation' not in username.co_agent_frontend_security %}
    {% include 'tt_website_rodextrip/header_corporate.html' %}
    {% endif %}
    <div>
    {%elif template == 6%}
    <header style="z-index:100;background:white;">
    {% if 'co_customer_parent_type_name' in username and 'corp_limitation' not in username.co_agent_frontend_security %}
    {% include 'tt_website_rodextrip/header_corporate.html' %}
    {% endif %}
    <div class="main-menu" style="border-bottom:1px solid #cdcdcd; padding:15px 0px 15px 0px;">
    {%endif%}
        <div class="container">
            <div class="row align-items-center justify-content-between d-flex">
                <div id="logo" class="col-lg-2 col-md-2 col-sm-2">
                    <a href="{% url 'tt_website_rodextrip:index'%}"><img src="{{logo}}" style="max-height:40px;max-width:150px;" alt="Logo {{name}}" title="{{name}}" /></a>
                </div>
                <div class="col-lg-10 col-md-10 col-sm-10" id="breadcrumbs_create">

                </div>
                <!--                <div class="col-lg-12">-->
                <!--                    <ul class="progressbar">-->
                <!--                        <li class="active" onclick="location.href='{% url 'tt_website_rodextrip:index'%}';" style="cursor:pointer;"><span>Home <i class="fas fa-home"></i></span></li>-->
                <!--                        <li class="active" onclick="location.href='{% url 'tt_website_rodextrip:airline_search'%}';" style="cursor:pointer;"><span>Search <i class="fas fa-search"></i></span></li>-->
                <!--                        <li class="current"><span>Passenger <i class="fas fa-users"></i></span></li>-->
                <!--                        <li><span>Book <i class="fas fa-book-open"></i></span></li>-->
                <!--                        <li><span>Issued <i class="fas fa-check-circle"></i></span></li>-->
                <!--                    </ul>-->
                <!--                </div>-->
                <div class="col-lg-12" id="div_4" hidden>
                    <div class="row">
                        <div class="col-lg-3 col-md-6 col-sm-6 col-xs-6" style="padding-top:10px">
                            <span style="font-size:13px; font-weight:500; padding-right:0px;"><i class="fas fa-stopwatch"></i> {% trans 'Session Time' %}: </span><span class="count_time" id="session_time"></span>
                        </div>
                        <div class="col-lg-3 col-md-6 col-sm-6 col-xs-6" style="padding-top:10px">
                            <span style="font-size:13px; font-weight:500; padding-right:0px;"><i class="fas fa-clock"></i> {% trans 'Elapsed Time' %}: <span class="count_time" id="elapse_time"> </span></span>
                        </div>
                        {% include 'tt_website_rodextrip/balance_credit.html' %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if username.co_user_login == 'agent_b2c' %}
    {% include 'tt_website_rodextrip/header_signin_signup.html' %}
    {% endif %}

</header>
{% include 'tt_website_rodextrip/loading_screen.html' %}

{% if username.co_user_login == 'agent_b2c' %}
{% include 'tt_website_rodextrip/modal_signin_signup.html' %}
{% endif %}

{%if template == 1%}
<section class="destinations-area" style="padding-top:30px; padding-bottom:40px;">
{% elif template == 2 %}
<section style="padding:15px 0px 15px 0px; background:#f7f7f7; border-bottom:2px solid #cdcdcd;">
{% elif template == 3 %}
<section class="relative" style="padding:15px 0px 15px 0px; background:#f7f7f7; border-bottom:2px solid #cdcdcd;">
{% elif template == 4 %}
<section style="padding:40px 0px 15px 0px; background:#f7f7f7; border-bottom:2px solid #cdcdcd;">
{% elif template == 5 %}
<section style="padding:15px 0px 15px 0px; background:#f7f7f7; border-bottom:2px solid #cdcdcd;">
{% elif template == 6 %}
<section class="destinations-area" style="background: #f7f7f7; padding-top:30px; padding-bottom:40px;">
{%endif%}
    <div class="container">
        <form method="POST" id="airline_booking" action="{% if after_sales == 0 %}/airline/review/{{signature}}{% else %}/airline/review_after_sales/{{signature}}{%endif%}">
            {% csrf_token %}
            <div class="row">
                <div class="col-lg-12" style="padding-bottom:15px;">
                    <h3>{% trans 'Special Service Request' %}</h3>
                </div>
                <div class="col-lg-8" style="padding-bottom:20px;">
                    <div class="row">
                        <div class="col-lg-12">
                            <div id="airline_review" style="background-color:white; padding:10px; margin-bottom:15px; border:1px solid #cdcdcd;">
                                {% for pax in passengers%}
                                {% with forloop.counter as counter_pax %}
                                <div style="padding-top:15px;">
                                    <h5 style="color:{{color}};"><i class="fas fa-user"></i> {{pax.title}} {{pax.first_name}} {{pax.last_name}}</h5>
                                    <hr/>
                                    {% if 'behaviors' in pax  and pax.behaviors|length > 0%}
                                        {% for key, provider_type in pax.behaviors.items %}
                                            {% if key == 'Airline'%}
                                        <h6 style="color:{{color}};">Behaviors</h6>
                                        <b>{{key}}</b><br/>
                                            {% for key,behavior_provider in provider_type.items %}
                                            <i>{{key}}</i>: <b>{{behavior_provider.value}}</b> {% if behavior_provider.remark != '' and behavior_provider.remark != False %} - {{behavior_provider.remark}} {% endif %} <br/>
                                            {% endfor%}
                                            {% endif %}
                                        {% endfor %}
                                        <hr/>
                                    {% endif %}
                                </div>
                                {% for ssr_provider in airline_ssrs.ssr_availability_provider %}
                                    {% with forloop.counter as counter_provider %}
                                    {% for img in ssr_provider.airline_list %}
                                    <img data-toggle="tooltip" style="width:50px; height:50px;" src="{{static_path_url_server}}/public/airline_logo/{{img}}.png" alt="Airline Logo">
                                    {% endfor %}
                                    <br/>
                                    {% for key, ssr_values in ssr_provider.ssr_availability.items %}

                                        {% for values in ssr_values %}
                                        {% with forloop.counter as counter_ssr %}
                                    <div class="row mt-1">
                                        <div class="col-lg-4">
                                            <span style="text-transform: capitalize; font-size:14px; font-weight:600;">
                                                {%if key == 'baggage'%}
                                                <i class="fas fa-suitcase"></i>
                                                {%elif key == 'equipment'%}
                                                <i class="fas fa-tools"></i>
                                                {%elif key == 'meal'%}
                                                <i class="fas fa-utensils"></i>
                                                {%endif%}

                                                {{key}}
                                                <br/>
                                                {{values.origin}} - {{values.destination}}<br/>
                                                {% for segment_values in values.segments %}
                                                {% if forloop.counter == 1 %}
                                                <script>
                                                document.write(moment('{{segment_values.departure_date}}').format('DD MMM YYYY'));
                                                </script>
                                                <br/>
                                                {% endif %}
                                                {% endfor %}
                                            </span>
                                        </div>
                                        {%if template == 1%}
                                            <div class="col-lg-8">
                                                <div class="input-container-search-ticket btn-group">
                                                    <div class="form-select" id="default-select">
                                                        <select id="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" name="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" data-live-search="true" size="4" onchange="on_change_ssr()">
                                                            <option value=""></option>
                                                            {% for ssr in values.ssrs %}
                                                            <option value="{{ssr.ssr_code}}_{{ssr.total_price}}" id="ssr_option_{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{forloop.counter}}"
                                                                    {% for ssr_list_pax in pax.ssr_list %}
                                                                        {% if key == ssr_list_pax.availability_type and ssr_list_pax.journey_code == ssr.journey_code and ssr.ssr_code == ssr_list_pax.fee_code %}
                                                                            selected
                                                                        {% endif %}
                                                                    {% endfor %}
                                                            >
                                                                {{ssr.name}} - {{ssr.currency}}
                                                            </option>
                                                            <script>
                                                                print_nominal_ssr("{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{ forloop.counter }}", {{ssr.total_price}});
                                                            </script>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        {% elif template == 2 %}
                                            <div class="col-lg-8">
                                                <div class="input-container-search-ticket btn-group">
                                                    <select id="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" name="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" data-live-search="true" size="4" onchange="on_change_ssr()">
                                                        <option value=""></option>
                                                        {% for ssr in values.ssrs %}
                                                        <option value="{{ssr.ssr_code}}_{{ssr.total_price}}" id="ssr_option_{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{forloop.counter}}" {% for ssr_list_pax in pax.ssr_list %}
                                                                {% if key == ssr_list_pax.availability_type and ssr_list_pax.journey_code == ssr.journey_code and ssr.name == ssr_list_pax.name %}
                                                                    selected {% endif %} {% endfor %}
                                                        >
                                                            {{ssr.name}} - {{ssr.currency}}
                                                        </option>
                                                        <script>
                                                            print_nominal_ssr("{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{ forloop.counter }}", {{ssr.total_price}});
                                                        </script>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        {% elif template == 3 %}
                                            <div class="col-lg-8">
                                                <div class="form-group">
                                                    <div class="default-select" id="default-select">
                                                        <select id="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" name="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" data-live-search="true" size="4" onchange="on_change_ssr()">
                                                            <option value=""></option>
                                                            {% for ssr in values.ssrs %}
                                                            <option value="{{ssr.ssr_code}}_{{ssr.total_price}}" id="ssr_option_{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{forloop.counter}}" {% for ssr_list_pax in pax.ssr_list %}
                                                                    {% if key == ssr_list_pax.availability_type and ssr_list_pax.journey_code == ssr.journey_code and ssr.name == ssr_list_pax.name %}
                                                                        selected {% endif %} {% endfor %}
                                                            >
                                                                {{ssr.name}} - {{ssr.currency}}
                                                            </option>
                                                            <script>
                                                                print_nominal_ssr("{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{ forloop.counter }}", {{ssr.total_price}});
                                                            </script>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        {% elif template == 4 %}
                                            <div class="col-lg-8">
                                                <div class="input-container-search-ticket btn-group">
                                                    <div class="form-select" id="default-select">
                                                        <select class="nice-select-default rounded" id="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" name="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" onchange="on_change_ssr()">
                                                            <option value=""></option>
                                                            {% for ssr in values.ssrs %}
                                                            <option value="{{ssr.ssr_code}}_{{ssr.total_price}}" id="ssr_option_{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{forloop.counter}}" {% for ssr_list_pax in pax.ssr_list %}
                                                                    {% if key == ssr_list_pax.availability_type and ssr_list_pax.journey_code == ssr.journey_code and ssr.name == ssr_list_pax.name %}
                                                                        selected {% endif %} {% endfor %}
                                                            >
                                                                {{ssr.name}} - {{ssr.currency}}
                                                            </option>
                                                            <script>
                                                                print_nominal_ssr("{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{ forloop.counter }}", {{ssr.total_price}});
                                                            </script>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        {% elif template == 5 %}
                                            <div class="col-lg-8">
                                                <div class="input-container-search-ticket" style="display:inline-block !important;">
                                                    <div id="default-select">
                                                        <select class="app-select form-control" id="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" name="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" onchange="on_change_ssr()">
                                                            <option value=""></option>
                                                            {% for ssr in values.ssrs %}
                                                            <option value="{{ssr.ssr_code}}_{{ssr.total_price}}" id="ssr_option_{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{forloop.counter}}" {% for ssr_list_pax in pax.ssr_list %}
                                                                    {% if key == ssr_list_pax.availability_type and ssr_list_pax.journey_code == ssr.journey_code and ssr.name == ssr_list_pax.name %}
                                                                        selected {% endif %} {% endfor %}
                                                            >
                                                                {{ssr.name}} - {{ssr.currency}}
                                                            </option>
                                                            <script>
                                                                print_nominal_ssr("{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{ forloop.counter }}", {{ssr.total_price}});
                                                            </script>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        {% elif template == 6 %}
                                            <div class="col-lg-8">
                                                <div class="input-container-search-ticket" style="display:inline-block !important;">
                                                    <div id="default-select">
                                                        <select class="app-select form-control" id="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" name="{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}" onchange="on_change_ssr()">
                                                            <option value=""></option>
                                                            {% for ssr in values.ssrs %}
                                                            <option value="{{ssr.ssr_code}}_{{ssr.total_price}}" id="ssr_option_{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{forloop.counter}}" {% for ssr_list_pax in pax.ssr_list %}
                                                                    {% if key == ssr_list_pax.availability_type and ssr_list_pax.journey_code == ssr.journey_code and ssr.name == ssr_list_pax.name %}
                                                                        selected {% endif %} {% endfor %}
                                                            >
                                                                {{ssr.name}} - {{ssr.currency}}
                                                            </option>
                                                            <script>
                                                                print_nominal_ssr("{{key}}_{{counter_provider}}_{{counter_pax}}_{{counter_ssr}}_{{ forloop.counter }}", {{ssr.total_price}});
                                                            </script>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        {%endif%}
                                        <div class="col-lg-12">
                                            <hr/>
                                        </div>
                                </div>
                                            {% endwith %}
                                            {% endfor %}
                                        {% endfor %}
                                        {% endwith %}
                                    {% endfor %}
                                    {% endwith %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="col-lg-4">
                            {% if after_sales == 1%}
                            <button type="button" class="issued_booking_btn primary-btn-white for-show-website" style="width:100%;" value="Cancel" onclick="go_back_page();">
                                {% trans 'Cancel' %}
                            </button>
                            {% endif %}
                        </div>
                        <div class="col-lg-4"></div>
                        <div class="col-lg-4">
                            <button class="btn-next for-show-website primary-btn next-passenger-train ld-ext-right" id="ssr_next_button" style="width:100%;" value="Next" onclick="next_disabled();next_ssr();">
                                {% trans 'Next' %}
                                <div class="ld ld-ring ld-cycle"></div>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4" style="padding-bottom:20px;" >
                    <div style="background-color:white; padding:10px 10px 0px 10px; border:1px solid #cdcdcd; top:10px;" id="airline_detail">

                    </div>
                </div>
                {% if after_sales == 1%}
                <div class="col-lg-12">
                    <button type="button" class="for-show-mobile issued_booking_btn primary-btn-white" style="width:100%;" value="Cancel" onclick="go_back_page();">
                        {% trans 'Cancel' %}
                    </button>
                </div>
                {% endif %}

                <div class="col-lg-12">
                    <button class="btn-next for-show-mobile primary-btn-white next-passenger-train ld-ext-right" style="width:100%;" value="Next" onclick="next_disabled();next_ssr();">
                        {% trans 'Next' %}
                        <div class="ld ld-ring ld-cycle"></div>
                    </button>
                </div>
            </div>
            <input type="hidden" id="time_limit_input" name="time_limit_input" />
            <input type="hidden" id="additional_price_input" name="additional_price_input" />
        </form>
        <textarea id="data_copy" name="data_copy" rows="4" hidden></textarea>
    </div>
</section>

{% include 'tt_website_rodextrip/footer.html' %}
<script>
    after_sales = false;
    if(time_limit != ''){
        document.getElementById('div_4').hidden = false;
        type  = '';
    }else{
        type = 'request_new';
        after_sales = true
    }
    get_airline_data_ssr_page(after_sales);
</script>
<!-- loader -->
{% endblock %}
